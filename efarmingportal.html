<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Farming Portal</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        nav ul {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        nav ul li {
            margin-left: 1rem;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
        }
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .auth-buttons button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .login-btn {
            background-color: white;
            color: #4CAF50;
        }
        .register-btn {
            background-color: #2E7D32;
            color: white;
        }
        .logout-btn {
            background-color: #f44336;
            color: white;
            display: none;
        }
        .user-info {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .hero {
            background-color: #E8F5E9;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 2rem;
        }
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .product-info {
            padding: 1rem;
        }
        .product-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .product-price {
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        .product-farmer {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .add-to-cart {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.5rem;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .add-to-cart:hover {
            background-color: #3e8e41;
        }
        .search-filter {
            display: flex;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .search-bar {
            flex-grow: 1;
            min-width: 200px;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        .filter {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-btn {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: bold;
        }
        form div {
            margin-bottom: 1rem;
        }
        form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        form input, form select, form textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #3e8e41;
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            margin-left: 1rem;
        }
        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
        }
        .cart-modal {
            max-height: 80vh;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .cart-item-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }
        .cart-item-details {
            flex-grow: 1;
            padding: 0 1rem;
        }
        .cart-item-title {
            font-weight: bold;
        }
        .cart-item-price {
            color: #4CAF50;
            font-weight: bold;
        }
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quantity-btn {
            background-color: #f0f0f0;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        .remove-btn {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 1rem;
        }
        .cart-total {
            font-weight: bold;
            font-size: 1.2rem;
            text-align: right;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
        }
        .checkout-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
            width: 100%;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .checkout-btn:hover {
            background-color: #3e8e41;
        }
        .profile-section {
            display: none;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1rem;
        }
        .tab {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            color: #666;
        }
        .tab.active {
            border-bottom: 3px solid #4CAF50;
            color: #4CAF50;
        }
        .tab-content {
            display: none;
            padding: 1rem 0;
        }
        .tab-content.active {
            display: block;
        }
        .order-item {
            background-color: #f9f9f9;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .order-item h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        .order-item p {
            margin: 0.5rem 0;
        }
        .order-products {
            margin-left: 1rem;
        }
        .rating {
            color: #FFD700;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        .empty-cart p {
            margin-bottom: 1rem;
        }
        .success-message {
            text-align: center;
            padding: 2rem;
            color: #4CAF50;
        }
        .success-message h2 {
            margin-top: 0;
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            .auth-buttons {
                margin-top: 1rem;
            }
            .search-filter {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">E-Farming Portal</div>
        <nav>
            <ul>
                <li><a href="#" class="home-link">Home</a></li>
                <li><a href="#" class="products-link">Products</a></li>
                <li><a href="#" class="profile-link">Profile</a></li>
                <li><a href="#" class="contact-link">Contact Farmers</a></li>
            </ul>
        </nav>
        <div class="auth-buttons">
            <button class="login-btn">Login</button>
            <button class="register-btn">Register</button>
            <button class="logout-btn">Logout</button>
            <div class="user-info">
                <span id="logged-in-user">User</span>
                <div class="cart-icon">
                    ðŸ›’
                    <span class="cart-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="hero">
            <h1>Welcome to E-Farming Portal</h1>
            <p>Connecting farmers directly to buyers and retailers</p>
        </div>

        <div class="search-filter">
            <input type="text" class="search-bar" placeholder="Search for products...">
            <select class="filter">
                <option value="">All Categories</option>
                <option value="fruits">Fruits</option>
                <option value="vegetables">Vegetables</option>
            </select>
            <select class="filter">
                <option value="">Price Range</option>
                <option value="0-50">â‚¹0 - â‚¹50</option>
                <option value="50-100">â‚¹50 - â‚¹100</option>
                <option value="100-500">â‚¹100 - â‚¹500</option>
            </select>
        </div>

        <div class="products">
            <!-- Product cards will be added here dynamically -->
        </div>

        <div class="profile-section">
            <div class="tabs">
                <div class="tab active" data-tab="orders">My Orders</div>
                <div class="tab" data-tab="details">Personal Details</div>
                <div class="tab" data-tab="reviews">My Reviews</div>
            </div>
            
            <div class="tab-content active" id="orders">
                <h2>My Orders</h2>
                <div class="order-list">
                    <!-- Orders will be added here dynamically -->
                </div>
            </div>
            
            <div class="tab-content" id="details">
                <h2>Personal Details</h2>
                <form id="profile-form">
                    <div>
                        <label for="name">Full Name</label>
                        <input type="text" id="name" value="John Doe">
                    </div>
                    <div>
                        <label for="email">Email</label>
                        <input type="email" id="email" value="john@example.com">
                    </div>
                    <div>
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" value="9876543210">
                    </div>
                    <div>
                        <label for="address">Address</label>
                        <textarea id="address" rows="3">123 Main St, City, State</textarea>
                    </div>
                    <button type="submit" class="submit-btn">Update Profile</button>
                </form>
            </div>
            
            <div class="tab-content" id="reviews">
                <h2>My Reviews</h2>
                <div class="reviews-list">
                    <!-- Reviews will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <h2>Login</h2>
            <form id="login-form">
                <div>
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div>
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="submit-btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <h2>Register</h2>
            <form id="register-form">
                <div>
                    <label for="reg-name">Full Name</label>
                    <input type="text" id="reg-name" required>
                </div>
                <div>
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" required>
                </div>
                <div>
                    <label for="reg-phone">Phone</label>
                    <input type="tel" id="reg-phone" required>
                </div>
                <div>
                    <label for="reg-password">Password</label>
                    <input type="password" id="reg-password" required>
                </div>
                <div>
                    <label for="reg-role">Role</label>
                    <select id="reg-role" required>
                        <option value="">Select Role</option>
                        <option value="farmer">Farmer</option>
                        <option value="buyer">Buyer</option>
                        <option value="retailer">Retailer</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cart-modal">
        <div class="modal-content cart-modal">
            <button class="close-btn">&times;</button>
            <h2>Your Cart</h2>
            <div class="cart-items">
                <!-- Cart items will be added here dynamically -->
            </div>
            <div class="cart-total">
                Total: â‚¹<span id="cart-total-amount">0</span>
            </div>
            <button class="checkout-btn">Proceed to Checkout</button>
        </div>
    </div>

    <!-- Checkout Success Modal -->
    <div class="modal" id="success-modal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <div class="success-message">
                <h2>Order Placed Successfully!</h2>
                <p>Thank you for your purchase.</p>
                <p>Your order will be delivered soon.</p>
            </div>
        </div>
    </div>

    <!-- Contact Farmer Modal -->
    <div class="modal" id="contact-modal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <h2>Contact Farmer</h2>
            <form id="contact-form">
                <div>
                    <label for="contact-subject">Subject</label>
                    <input type="text" id="contact-subject" required>
                </div>
                <div>
                    <label for="contact-message">Message</label>
                    <textarea id="contact-message" rows="5" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Send Message</button>
            </form>
        </div>
    </div>

    <script>
        // Real product data with guaranteed working images
        const products = [
            {
                id: 1,
                title: "Fresh Apples",
                category: "fruits",
                price: 120,
                image: "https://images.unsplash.com/photo-1568702846914-96b305d2aaeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Rajesh Farms",
                rating: 4.5,
                description: "Fresh, crispy and juicy apples straight from the orchard."
            },
            {
                id: 3,
                title: "Bananas",
                category: "fruits",
                price: 60,
                image: "https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Tropical Fruits Co.",
                rating: 4.0,
                description: "Sweet and nutritious bananas packed with energy."
            },
            {
                id: 4,
                title: "Potatoes",
                category: "vegetables",
                price: 30,
                image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Root Vegetables Ltd.",
                rating: 3.8,
                description: "Freshly harvested potatoes perfect for any dish."
            },
            {
                id: 6,
                title: "Carrots",
                category: "vegetables",
                price: 40,
                image: "https://images.unsplash.com/photo-1447175008436-054170c2e979?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Organic Valley",
                rating: 4.1,
                description: "Crunchy and sweet carrots packed with nutrients."
            },
            {
                id: 7,
                title: "Grapes",
                category: "fruits",
                price: 90,
                image: "https://images.unsplash.com/photo-1550258987-190a2d41a8ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Vineyard Fresh",
                rating: 4.4,
                description: "Sweet seedless grapes perfect for snacking."
            },
            {
                id: 8,
                title: "Spinach",
                category: "vegetables",
                price: 35,
                image: "https://images.unsplash.com/photo-1576045057995-568f588f82fb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Green Leaf Farms",
                rating: 4.0,
                description: "Fresh spinach leaves packed with iron and vitamins."
            },
            {
                id: 9,
                title: "Strawberries",
                category: "fruits",
                price: 150,
                image: "https://images.unsplash.com/photo-1464965911861-746a04b4bca6?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Berry Good Farms",
                rating: 4.6,
                description: "Sweet and juicy strawberries, perfect for desserts."
            },
            {
                id: 10,
                title: "Broccoli",
                category: "vegetables",
                price: 50,
                image: "https://images.unsplash.com/photo-1584270354949-c26b0d5b4a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                farmer: "Green Fields",
                rating: 4.0,
                description: "Fresh broccoli packed with nutrients and vitamins."
            }
        ];

        // Sample order data
        const orders = [
            {
                id: 1001,
                date: "2023-05-15",
                items: [
                    { product: "Fresh Apples", quantity: 2, price: 120 },
                    { product: "Bananas", quantity: 3, price: 60 }
                ],
                total: 420,
                status: "Delivered"
            },
            {
                id: 1002,
                date: "2023-05-10",
                items: [
                    { product: "Grapes", quantity: 2, price: 90 }
                ],
                total: 180,
                status: "Delivered"
            }
        ];

        // Sample review data
        const reviews = [
            {
                product: "Fresh Apples",
                rating: 5,
                comment: "Excellent quality, very fresh! Will order again.",
                date: "2023-05-16"
            },
            {
                product: "Bananas",
                rating: 4,
                comment: "Good quality and perfectly ripe when delivered",
                date: "2023-05-12"
            }
        ];

        // DOM elements
        const productsContainer = document.querySelector('.products');
        const orderList = document.querySelector('.order-list');
        const reviewsList = document.querySelector('.reviews-list');
        const cartItemsContainer = document.querySelector('.cart-items');
        const cartTotalAmount = document.getElementById('cart-total-amount');
        const cartCount = document.querySelector('.cart-count');
        const searchBar = document.querySelector('.search-bar');
        const categoryFilter = document.querySelectorAll('.filter')[0];
        const priceFilter = document.querySelectorAll('.filter')[1];
        const profileSection = document.querySelector('.profile-section');
        const homeLink = document.querySelector('.home-link');
        const productsLink = document.querySelector('.products-link');
        const profileLink = document.querySelector('.profile-link');
        const contactLink = document.querySelector('.contact-link');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Auth elements
        const loginBtn = document.querySelector('.login-btn');
        const registerBtn = document.querySelector('.register-btn');
        const logoutBtn = document.querySelector('.logout-btn');
        const userInfo = document.querySelector('.user-info');
        const loggedInUser = document.getElementById('logged-in-user');

        // Modals
        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const cartModal = document.getElementById('cart-modal');
        const successModal = document.getElementById('success-modal');
        const contactModal = document.getElementById('contact-modal');
        const cartIcon = document.querySelector('.cart-icon');
        const closeBtns = document.querySelectorAll('.close-btn');
        const checkoutBtn = document.querySelector('.checkout-btn');

        // App state
        let cart = [];
        let currentUser = null;

        // Initialize the app
        function init() {
            renderProducts(products);
            renderOrders();
            renderReviews();
            setupEventListeners();
            updateCartCount();
            updateAuthUI();
        }

        // Update authentication UI
        function updateAuthUI() {
            if (currentUser) {
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                userInfo.style.display = 'flex';
                loggedInUser.textContent = currentUser.name;
                profileLink.style.display = 'block';
            } else {
                loginBtn.style.display = 'block';
                registerBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                userInfo.style.display = 'none';
                profileLink.style.display = 'none';
            }
        }

        // Render products
        function renderProducts(productsToRender) {
            productsContainer.innerHTML = '';
            
            if (productsToRender.length === 0) {
                productsContainer.innerHTML = '<p style="grid-column:1/-1;text-align:center;">No products found matching your criteria.</p>';
                return;
            }
            
            productsToRender.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.title}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=Product+Image'">
                    <div class="product-info">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">â‚¹${product.price}</div>
                        <div class="product-farmer">Farmer: ${product.farmer}</div>
                        <div class="rating">${renderStars(product.rating)}</div>
                        <button class="add-to-cart" data-id="${product.id}">Add to Cart</button>
                    </div>
                `;
                productsContainer.appendChild(productCard);
            });
        }

        // Render star ratings
        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = 'â˜…'.repeat(fullStars);
            if (hasHalfStar) stars += 'Â½';
            stars += 'â˜†'.repeat(5 - fullStars - (hasHalfStar ? 1 : 0));
            return stars;
        }

        // Render orders
        function renderOrders() {
            orderList.innerHTML = '';
            
            if (orders.length === 0) {
                orderList.innerHTML = '<p>You have no orders yet.</p>';
                return;
            }
            
            orders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                
                let itemsHtml = '<div class="order-products">';
                order.items.forEach(item => {
                    itemsHtml += `<p>${item.quantity} x ${item.product} - â‚¹${item.price * item.quantity}</p>`;
                });
                itemsHtml += '</div>';
                
                orderItem.innerHTML = `
                    <h3>Order #${order.id}</h3>
                    <p><strong>Date:</strong> ${order.date}</p>
                    ${itemsHtml}
                    <p><strong>Total:</strong> â‚¹${order.total}</p>
                    <p><strong>Status:</strong> ${order.status}</p>
                `;
                orderList.appendChild(orderItem);
            });
        }

        // Render reviews
        function renderReviews() {
            reviewsList.innerHTML = '';
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = '<p>You have not reviewed any products yet.</p>';
                return;
            }
            
            reviews.forEach(review => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'order-item';
                reviewItem.innerHTML = `
                    <h3>${review.product}</h3>
                    <p><strong>Date:</strong> ${review.date}</p>
                    <div class="rating">${renderStars(review.rating)}</div>
                    <p>${review.comment}</p>
                `;
                reviewsList.appendChild(reviewItem);
            });
        }

        // Render cart
        function renderCart() {
            cartItemsContainer.innerHTML = '';
            let total = 0;
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <p>Your cart is empty</p>
                        <button class="submit-btn" onclick="cartModal.style.display='none'">Continue Shopping</button>
                    </div>
                `;
                document.querySelector('.cart-total').style.display = 'none';
                document.querySelector('.checkout-btn').style.display = 'none';
                return;
            }
            
            document.querySelector('.cart-total').style.display = 'block';
            document.querySelector('.checkout-btn').style.display = 'block';
            
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="${product.image}" alt="${product.title}" class="cart-item-img" onerror="this.src='https://via.placeholder.com/60x60?text=Product'">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${product.title}</div>
                            <div class="cart-item-price">â‚¹${product.price}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn minus" data-id="${product.id}">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn plus" data-id="${product.id}">+</button>
                            </div>
                        </div>
                        <button class="remove-btn" data-id="${product.id}">Ã—</button>
                    `;
                    cartItemsContainer.appendChild(cartItem);
                    total += product.price * item.quantity;
                }
            });
            
            cartTotalAmount.textContent = total;
            updateCartCount();
        }

        // Update cart count
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = count;
            cartCount.style.display = count > 0 ? 'flex' : 'none';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login/Register buttons
            loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            registerBtn.addEventListener('click', () => registerModal.style.display = 'flex');
            logoutBtn.addEventListener('click', logout);
            
            // Cart icon
            cartIcon.addEventListener('click', () => {
                renderCart();
                cartModal.style.display = 'flex';
            });
            
            // Contact link
            contactLink.addEventListener('click', (e) => {
                e.preventDefault();
                contactModal.style.display = 'flex';
            });
            
            // Close modals
            closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Add to cart buttons
            productsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart')) {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    addToCart(productId);
                    alert('Product added to cart!');
                }
            });
            
            // Cart quantity and remove buttons
            cartItemsContainer.addEventListener('click', (e) => {
                const productId = parseInt(e.target.getAttribute('data-id'));
                
                if (e.target.classList.contains('minus')) {
                    updateCartItemQuantity(productId, -1);
                } else if (e.target.classList.contains('plus')) {
                    updateCartItemQuantity(productId, 1);
                } else if (e.target.classList.contains('remove-btn')) {
                    removeFromCart(productId);
                }
            });
            
            // Checkout button
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', checkout);
            }
            
            // Search and filter
            searchBar.addEventListener('input', filterProducts);
            categoryFilter.addEventListener('change', filterProducts);
            priceFilter.addEventListener('change', filterProducts);
            
            // Navigation links
            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showHomePage();
            });
            
            productsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showProductsPage();
            });
            
            profileLink.addEventListener('click', (e) => {
                e.preventDefault();
                showProfilePage();
            });
            
            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
                });
            });
            
            // Form submissions
            document.getElementById('login-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                login(email, password);
            });
            
            document.getElementById('register-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const phone = document.getElementById('reg-phone').value;
                const password = document.getElementById('reg-password').value;
                const role = document.getElementById('reg-role').value;
                register(name, email, phone, password, role);
            });
            
            document.getElementById('contact-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Message sent to farmer!');
                contactModal.style.display = 'none';
            });
            
            document.getElementById('profile-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Profile updated successfully!');
            });
        }

        // Login function
        function login(email, password) {
            // In a real app, you would validate credentials with a server
            // For this demo, we'll just simulate a successful login
            currentUser = {
                name: email.split('@')[0],
                email: email,
                role: 'buyer' // Default role for demo
            };
            
            alert('Login successful!');
            loginModal.style.display = 'none';
            updateAuthUI();
        }

        // Register function
        function register(name, email, phone, password, role) {
            // In a real app, you would send this data to a server
            // For this demo, we'll just simulate a successful registration
            currentUser = {
                name: name,
                email: email,
                role: role
            };
            
            alert('Registration successful! You are now logged in.');
            registerModal.style.display = 'none';
            updateAuthUI();
        }

        // Logout function
        function logout() {
            currentUser = null;
            alert('You have been logged out.');
            updateAuthUI();
        }

        // Show home page
        function showHomePage() {
            profileSection.style.display = 'none';
            document.querySelector('.products').style.display = 'grid';
            document.querySelector('.hero').style.display = 'block';
            document.querySelector('.search-filter').style.display = 'flex';
        }

        // Show products page
        function showProductsPage() {
            profileSection.style.display = 'none';
            document.querySelector('.products').style.display = 'grid';
            document.querySelector('.hero').style.display = 'none';
            document.querySelector('.search-filter').style.display = 'flex';
        }

        // Show profile page
        function showProfilePage() {
            if (!currentUser) {
                alert('Please login to view your profile');
                return;
            }
            profileSection.style.display = 'block';
            document.querySelector('.products').style.display = 'none';
            document.querySelector('.hero').style.display = 'none';
            document.querySelector('.search-filter').style.display = 'none';
        }

        // Add to cart function
        function addToCart(productId) {
            if (!currentUser) {
                alert('Please login to add items to cart');
                loginModal.style.display = 'flex';
                return;
            }
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id: productId, quantity: 1 });
            }
            updateCartCount();
        }

        // Update cart item quantity
        function updateCartItemQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    renderCart();
                }
            }
        }

        // Remove from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            renderCart();
        }

        // Checkout function
        function checkout() {
            if (!currentUser) {
                alert('Please login to checkout');
                loginModal.style.display = 'flex';
                return;
            }
            
            if (cart.length === 0) return;
            
            // In a real app, you would send the cart data to a server here
            // For this demo, we'll just show a success message
            cart = [];
            renderCart();
            cartModal.style.display = 'none';
            successModal.style.display = 'flex';
        }

        // Filter products
        function filterProducts() {
            const searchTerm = searchBar.value.toLowerCase();
            const category = categoryFilter.value;
            const priceRange = priceFilter.value;
            
            let filtered = products.filter(product => {
                const matchesSearch = product.title.toLowerCase().includes(searchTerm) || 
                                     product.farmer.toLowerCase().includes(searchTerm) ||
                                     product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || product.category === category;
                
                let matchesPrice = true;
                if (priceRange) {
                    const [min, max] = priceRange.split('-').map(Number);
                    matchesPrice = product.price >= min && (!max || product.price <= max);
                }
                
                return matchesSearch && matchesCategory && matchesPrice;
            });
            
            renderProducts(filtered);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>